self.window.trackingSDK.define(["exports","https://deo.shopeemobile.com/shopee/shopee-trackingsdk-live-sg/amd/@shopee/tracking-core@1.2.0.min.js"],(function(t,e){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var i=function(){return(i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function r(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function s(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((o=o.apply(t,e||[])).next())}))}function a(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}var s=["360","alice","alltheweb","altavista","aol","ask","auone","avg","babylon","baidu","biglobe","bing","centrum","comcast","conduit","cnn","daum","duckduckgo","ecosia","ekolay","eniro","globo","go.mail.ru","google","goo.ne","haosou.com","incredimail","kvasir","live","lycos","mamma","msn","mynet","najdi","naver","netscape","onet","ozu","rakuten","rambler","search-results","search.smt.docomo","sesam","seznam","so.com","sogou","startsiden","szukacz","terra","tut.by","ukr","virgilio","voila","wp.pl","yahoo","yandex","yam"];var u=[],c=function(){function t(t,e){var n=this;this.context=t,this.methodName=e,this.originalMethodReference=t[e],this.methodChain=[],this.boundMethodChain=[],this.wrappedMethod=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=n.boundMethodChain[n.boundMethodChain.length-1];return o.apply(void 0,t)},t[e]=this.wrappedMethod}return t.add=function(t,e,n){d(t,e).add(n)},t.remove=function(t,e,n){var o=h(t,e);o&&o.remove(n)},t.prototype.add=function(t){this.methodChain.push(t),this.rebindMethodChain()},t.prototype.remove=function(t){var e=this.methodChain.indexOf(t);e>-1&&(this.methodChain.splice(e,1),this.methodChain.length>0?this.rebindMethodChain():this.destory())},t.prototype.rebindMethodChain=function(){this.boundMethodChain=[];for(var t=void 0,e=0;t=this.methodChain[e];e++){var n=this.boundMethodChain[e-1]||this.originalMethodReference.bind(this.context);this.boundMethodChain.push(t(n))}},t.prototype.destory=function(){var t=u.indexOf(this);t>-1&&(u.splice(t,-1),this.context[this.methodName]=this.originalMethodReference)},t}();function h(t,e){return u.filter((function(n){return n.context===t&&n.methodName===e}))[0]}function d(t,e){var n=h(t,e);return n||(n=new c(t,e),u.push(n)),n}var l="gclid",p="dclid",f="is_seller",v="gbraid",g="wbraid",m=[l,p,"utm_source","utm_medium","utm_campaign","utm_content",v,g,"utm_term","affiliate_trackid"];function y(t){return Object.keys(t).length<=0}function _(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function b(t){var e=t||{},n={};if(function(t,e){return e.some((function(e){return!!_(t,e)}))}(e,m)){n=function(t,e){return e.reduce((function(e,n){var o;return"string"==typeof t[n]&&t[n].length>0?i(i({},e),((o={})[n]=t[n],o)):e}),{})}(e,m)||{};var o=Object.keys(n);o.includes(l)?n.shopee_key=l:o.includes(p)?n.shopee_key=p:o.includes(v)?n.shopee_key=v:o.includes(g)?(n.shopee_key=g,n.shopee_key=l):Object.keys(n).includes(p)&&(n.shopee_key=p)}return _(e,f)&&(n.is_seller="true"===e.is_seller),i(i({},n),function(){var t=document.referrer;if(!t)return{};var e=function(t){for(var e=0;e<s.length;e++)if(-1!==t.indexOf(s[e]))return s[e];return-1!==t.indexOf("cdn.ampproject.org")?"amp":null}(t);if(e)return{stm_source:""+e,stm_medium:"organic"};return{stm_source:""+t,stm_medium:"referral"}}())}function k(t){if(t.hash&&t.hash.startsWith("#/")){var e=t.hash.lastIndexOf("#");return 0===e?t.hash.substring(1):t.hash.substring(1,e)}return t.pathname}var w=function(){function t(t){var n={shouldTrackHistoryChange:this.shouldTrackHistoryChange,trackReplaceState:!1};this.opts=i(i({},n),t),this.path=location.pathname+location.hash+location.search,this.pathname=k(location),this.eventId=e.trackingSessionManager.getLatestEventId(),this.pushStateOverride=this.pushStateOverride.bind(this),this.replaceStateOverride=this.replaceStateOverride.bind(this),this.handlePopState=this.handlePopState.bind(this),this.handleHashChange=this.handleHashChange.bind(this),this.handleLoad=this.handleLoad.bind(this),self.history?(c.add(history,"pushState",this.pushStateOverride),c.add(history,"replaceState",this.replaceStateOverride),window.addEventListener("popstate",this.handlePopState)):window.addEventListener("hashchange",this.handleHashChange),this.handleLoad()}return t.prototype.pushStateOverride=function(t){var e=this;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];t.apply(void 0,n),e.handleHistoryChange(!0)}},t.prototype.replaceStateOverride=function(t){var e=this;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];t.apply(void 0,n),e.handleHistoryChange(!1)}},t.prototype.handlePopState=function(){this.handleHistoryChange(!0)},t.prototype.handleHashChange=function(){this.handleHistoryChange(!0)},t.prototype.handleLoad=function(){var t=this,e={isOnload:!0,referrer:self.document.referrer,eventId:this.eventId,href:self.location.href,hostname:self.location.hostname,pathname:this.pathname,absolutePath:location.host+location.pathname+location.hash};setTimeout((function(){try{t.sendPageview(e)}catch(t){console.warn("[AutoTracker]",t)}}),300)},t.prototype.sendPageview=function(t){return r(this,void 0,void 0,(function(){var n,o,r,s,u,c,h,d,l,p,f;return a(this,(function(a){switch(a.label){case 0:return[4,e.trackingSessionManager.getSession()];case 1:return n=a.sent(),o=Date.now(),r=function(t){var e={},n=(t=t||"").indexOf("?");if(-1!==n){var o=t.substring(n+1);(o=o.split("#")[0]).split("&").forEach((function(t){if(t){var n=t.indexOf("="),o=n>-1?t.substring(0,n):t,i=n>-1?decodeURIComponent(t.substring(n+1)):"";e[o]=i}}))}return e}(t.href),s={auto_mapped_view:e.trackingSessionManager.getLatestViewPageType(),auto_refer:t.referrer,auto_pathname:t.pathname,auto_url:t.href,start_time:o},y(r)||(s.param_string=JSON.stringify(r)),v=t.referrer,g=t.hostname,u=!!v&&v.split("/")[2]===g,(t.isOnload&&u||!t.isOnload)&&!y(c=function(t){var e={};return Object.prototype.hasOwnProperty.call(t,"event_source")&&(e.event_source=t.event_source),e}(r))&&(s=i(i({},s),c)),!t.isOnload||u?[3,3]:(!y(h=b(r))&&(s=i(i({},s),h)),function(t){if(!t)return!1;var e=new URL(t).searchParams;return!!m.some((function(t){return e.has(t)}))}(t.href)?[4,e.trackingSessionManager.getSession(!0)]:[3,3]);case 2:n=a.sent(),a.label=3;case 3:return d=this.opts.tracker.getABTest(),l={civ_id:t.eventId,data:{auto_pv_common:s},sequence_id:n.sequenceId,session_id:n.sessionId,ab_test:d,event_timestamp:o,type:"v4",auto_view_id:"browser-abs|"+t.absolutePath,operation:"auto_view"},this.opts.autoTrackMatchRoutes&&(p=this.opts.autoTrackMatchRoutes(t.absolutePath),f=this.opts.autoTrackMatchRoutes(t.referrer),l.auto_view_id=p?"browser|"+p:l.auto_view_id,l.data.auto_pv_common.auto_refer=f?"browser|"+f:l.data.auto_pv_common.auto_refer),this.opts.tracker.logEvent(l),[2]}var v,g}))}))},t.prototype.shouldTrackHistoryChange=function(t,e){return!(!t||!e)},t.prototype.handleHistoryChange=function(t){var n,o=this,i=this.path,r=this.pathname,a=location.pathname+location.hash+location.search,s=k(location);if(i!==a&&(null===(n=this.opts.shouldTrackHistoryChange)||void 0===n?void 0:n.call(this,a,i))&&(this.path=a,this.pathname=s,t||this.opts.trackReplaceState)){this.eventId=e.uuidv4(),e.scheduleWhenIdle((function(){e.trackingSessionManager.setLatestEventId(o.eventId)}));var u={isOnload:!1,referrer:r,eventId:this.eventId,href:self.location.href,hostname:self.location.hostname,pathname:this.pathname,absolutePath:location.host+location.pathname+location.hash};setTimeout((function(){try{o.sendPageview(u)}catch(t){console.warn("[AutoTracker]",t)}}),300)}},t}();var S=function(t){function n(n){var o=t.call(this,n)||this;return o.batchNumber=20,o.storage=window.indexedDB?new e.IndexedDBStorage(4):new e.MemoStorage,o.user_id=NaN,o.ab_test="",o.options=i({env:"live",enableAutoTrack:!0,sendImmediately:!1},n),o}return o(n,t),n.prototype.init=function(){return r(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.storage.init()];case 1:return t.sent(),this.storage.removeExpiredEvents(),e.trackingSessionManager.useStorage(this.storage),e.trackingSessionManager.setLatestEventId(e.uuidv4()),!1!==this.options.enableAutoTrack&&(this.autoTracker=new w({tracker:this,autoTrackMatchRoutes:this.options.autoTrackMatchRoutes})),this.initScheduler(),[2]}}))}))},n.prototype.setUserId=function(t){this.user_id=t},n.prototype.getUserId=function(){return this.user_id},n.prototype.setABTest=function(t){this.ab_test=t},n.prototype.getABTest=function(){return this.ab_test},n.prototype.logDirectly=function(t){this.sendData([t])},n.prototype.logBatchly=function(t){this.storage.addEvent(t)},n.prototype.logJSBridge=function(t){},n.prototype.preProcess=function(t){var n=this,o=e.trackingSessionManager.getLatestEventId();return e.trackingSessionManager.getSession().then((function(r){var a,s,u,c=(a=n.options,s=r.sessionId,u=r.sequenceId,{event_timestamp:Date.now(),device_id:a.device_id||e.getCookie("SPC_F")||e.getDEDeviceID(),country:a.locale,platform:a.platform||"pc_web",platform_implementation:"pc",user_agent:"undefined"!=typeof navigator?navigator.userAgent:"",usage_id:0,token:"",operation:"",page_type:"",page_section:"",target_type:"",app_id:a.appId,session_id:s,sequence_id:u,signature:"",type:"v4",domain:location.hostname,de_device_id:e.getDEDeviceID()});return i(i(i({civ_id:o},c),t),{sequence_id:r.sequenceId,session_id:r.sessionId,user_id:n.user_id||t.user_id,ab_test:n.ab_test||t.ab_test})}))},n.prototype.sendData=function(t){if(0===t.length)return Promise.resolve();var n=e.getEndpoint(this.options.env,"v4/tr",this.options.locale),o={"X-SPC-DF":t[0].device_id,"Content-Type":"application/json"};return Promise.all(e.constraintSize(t,O).map((function(t){return e.withRetry((function(){return e.post(n,{headers:o,body:JSON.stringify(t)}).then((function(t){return 200!==(null==t?void 0:t.status)?Promise.reject():t}))}),1e3,"INF")})))},n.prototype.initScheduler=function(){var t=this,n=null;this.myScheduler=new e.Scheduler({onInterval:function(){return r(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.storage.getEvents(this.batchNumber)];case 1:return n=t.sent(),[2,this.sendData(n.data)]}}))}))},onFinish:function(){return r(t,void 0,void 0,(function(){return a(this,(function(t){return[2,this.storage.removeEvents((null==n?void 0:n.keys)||[])]}))}))},onError:function(o){return r(t,void 0,void 0,(function(){return a(this,(function(t){return console.error(o),n?(null==n?void 0:n.keys)&&this.storage instanceof e.IndexedDBStorage?[2,this.storage.resetEvents(n.keys)]:[2,this.storage.resetEvents([],n.data)]:[2,Promise.resolve()]}))}))},onUnload:function(){return r(t,void 0,void 0,(function(){return a(this,(function(t){return[2]}))}))}})},n}(e.ITracker);function O(t){var e=Math.ceil(t.length/2);return e===t.length?[t]:[t.slice(0,e),t.slice(e,t.length)]}var C=function(t){function e(e){return t.call(this,e)||this}return o(e,t),e.prototype.click=function(t,e,n,o,i){void 0===i&&(i=null),this.logEvent({page_type:t,page_section:e,target_type:n,operation:"click",platform_implementation:o,data:i})},e.prototype.impression=function(t,e,n,o,i){void 0===i&&(i=null),this.logEvent({page_type:t,page_section:e,target_type:n,operation:"impression",platform_implementation:o,data:i})},e.prototype.view=function(t,e,n){void 0===n&&(n=null),this.logEvent({page_type:t,operation:"view",platform_implementation:e,data:n})},e.prototype.trackEvent=function(t,e,n,o,i,r){void 0===r&&(r=null),this.logEvent({page_type:e,page_section:n,target_type:o,operation:t,platform_implementation:i,data:r})},e.prototype.logEventV3=function(t){var e,n,o,i,r,a,s,u,c,h,d,l,p,f,v=(o=(n=e=t).timestamp,i=n.session_id,r=void 0===i?void 0:i,a=n.sequence_id,s=void 0===a?void 0:a,u=n.ab_test,c=void 0===u?void 0:u,h=n.source,d=e.info,l=d.page_type,p=d.operation,f=d.target_type,{event_timestamp:o,sequence_id:s,session_id:r,page_type:l,page_section:d.page_section,operation:p,target_type:f,ab_test:c,data:d.data,platform_implementation:h});this.logEvent(v)},e}(S);t.CoreTracker=S,t.UBTTracker=C,t.default=C,Object.defineProperty(t,"__esModule",{value:!0})}));